import{b as G,d as z,e as Q}from"./chunk-XGQUN4LM.js";import{$ as w,$a as C,Cb as L,Ga as l,Ha as p,Ia as U,Ja as E,Ka as _,Oa as S,Ua as m,Wa as c,Y as k,Ya as D,Z as T,Za as u,_a as h,a as r,ba as B,cb as v,db as M,eb as j,fa as I,ga as g,gb as A,ha as R,hb as O,ib as x,jb as N,lb as F,n as y,rb as P,ub as V}from"./chunk-WIFXGSG2.js";var Y=["templateOutlet"],q=t=>({active:t});function K(t,n){if(t&1&&(u(0,"div",7),N(1),h()),t&2){let e=v(2);l(),F(" ",e.message||e.defaultMessage," ")}}function H(t,n){if(t&1&&(u(0,"div",4),C(1,"div",5),m(2,K,2,1,"div",6),h()),t&2){let e=v();l(2),c("ngIf",e.message||e.defaultMessage)}}function J(t,n){}function W(t,n){t&1&&m(0,J,0,0,"ng-template",null,0,V)}var X=["*"],b="block-ui-main",o=(()=>{class t{}return t.START="start",t.STOP="stop",t.UPDATE="update",t.RESET="reset",t.RESET_GLOBAL="reset_global",t.UNSUBSCRIBE="unsubscribe",t})(),d=(()=>{class t{constructor(){this.blockUISettings={},this.blockUIInstances={},this.blockUISubject=new y(1),this.blockUIObservable=this.blockUISubject.asObservable(),this.blockUIObservable.subscribe(this.blockUIMiddleware.bind(this))}getSettings(){return this.blockUISettings}updateSettings(e={}){this.blockUISettings=r(r({},this.blockUISettings),e)}decorate(e=b){let i={name:e,isActive:!1,blockCount:0,start:this.dispatch(this.blockUISubject,o.START,e),update:this.dispatch(this.blockUISubject,o.UPDATE,e),stop:this.dispatch(this.blockUISubject,o.STOP,e),reset:this.dispatch(this.blockUISubject,o.RESET,e),resetGlobal:this.dispatch(this.blockUISubject,o.RESET_GLOBAL,e),unsubscribe:this.dispatch(this.blockUISubject,o.UNSUBSCRIBE,e)};return this.blockUIInstances[e]=this.blockUIInstances[e]||i,i}observe(){return this.blockUIObservable}clearInstance(e){this.dispatch(this.blockUISubject,o.RESET,e)}blockUIMiddleware({action:e,name:i}){let s=null;switch(e){case o.START:s=!0;break;case o.STOP:case o.RESET:s=!1;break}s!==null&&(this.blockUIInstances[i].isActive=s)}dispatch(e,i,s=b){return a=>{e.next({name:s,action:i,message:a})}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=k({token:t,factory:t.\u0275fac}),t})();var ee=(()=>{class t{constructor(e,i,s){this.blockUI=e,this.resolver=i,this.changeDetectionRef=s,this.name=b,this.defaultBlockState={startTimeouts:[],stopTimeouts:[],updateTimeouts:[],blockCount:0,startCallCount:0,stopCallCount:0},this.state=r({},this.defaultBlockState)}ngOnInit(){this.settings=this.blockUI.getSettings(),this.blockUISubscription=this.subscribeToBlockUI(this.blockUI.observe())}ngAfterViewInit(){try{if(!this.templateCmp)return!1;if(this.templateCmp instanceof U)this.templateOutlet.createEmbeddedView(this.templateCmp);else{let e=this.resolver.resolveComponentFactory(this.templateCmp);this.templateCompRef=this.templateOutlet.createComponent(e),this.updateBlockTemplate(this.message)}}catch(e){console.error("ng-block-ui:",e)}}ngAfterViewChecked(){this.detectChanges()}subscribeToBlockUI(e){return e.subscribe(i=>this.onDispatchedEvent(i))}onDispatchedEvent(e){switch(e.action){case o.START:this.onStart(e);break;case o.STOP:this.onStop(e);break;case o.UPDATE:this.onUpdate(e);break;case o.RESET:this.onReset(e);break;case o.RESET_GLOBAL:this.resetState();break;case o.UNSUBSCRIBE:this.onStop(e),this.onUnsubscribe(e.name);break}}onStart({name:e,message:i}){if(e===this.name){let s=this.delayStart??this.settings.delayStart??0;this.state.startCallCount+=1;let a=setTimeout(()=>{this.state.blockCount+=1,this.showBlock(i),this.updateInstanceBlockCount()},s);this.state.startTimeouts.push(a)}}onStop({name:e}){if(e===this.name){let i=this.state.stopCallCount+1;if(this.state.startCallCount-i>=0){let s=this.delayStop??this.settings.delayStop??0;this.state.stopCallCount=i;let a=setTimeout(()=>{this.state.blockCount-=1,this.updateInstanceBlockCount(),this.detectChanges()},s);this.state.stopTimeouts.push(a)}}}onUpdate({name:e,message:i}){if(e===this.name){let s=this.delayStart||this.settings.delayStart||0;clearTimeout(this.state.updateTimeouts[0]);let a=setTimeout(()=>{this.updateMessage(i)},s);this.state.updateTimeouts.push(a)}}onReset({name:e}){e===this.name&&this.resetState()}updateMessage(e){this.showBlock(e)}showBlock(e){this.message=e||this.defaultMessage||this.settings.message,this.updateBlockTemplate(this.message),this.detectChanges()}updateBlockTemplate(e){this.templateCompRef&&this.templateCompRef instanceof E&&(this.templateCompRef.instance.message=e)}resetState(){[...this.state.startTimeouts,...this.state.stopTimeouts,...this.state.updateTimeouts].forEach(clearTimeout),this.state=r({},this.defaultBlockState),this.updateInstanceBlockCount(),this.detectChanges()}onUnsubscribe(e){this.blockUISubscription&&e===this.name&&this.blockUISubscription.unsubscribe()}updateInstanceBlockCount(){if(this.blockUI.blockUIInstances[this.name]){let{blockCount:e}=this.state;this.blockUI.blockUIInstances[this.name].blockCount=e}}detectChanges(){this.changeDetectionRef.destroyed||this.changeDetectionRef.detectChanges()}ngOnDestroy(){this.resetState(),this.onUnsubscribe(this.name),this.blockUI.clearInstance(this.name)}}return t.\u0275fac=function(e){return new(e||t)(p(d),p(_),p(L))},t.\u0275cmp=g({type:t,selectors:[["block-ui-content"]],viewQuery:function(e,i){if(e&1&&A(Y,5,S),e&2){let s;O(s=x())&&(i.templateOutlet=s.first)}},inputs:{name:"name",delayStart:"delayStart",delayStop:"delayStop",defaultMessage:[I.None,"message","defaultMessage"],templateCmp:[I.None,"template","templateCmp"]},decls:3,vars:9,consts:[["templateOutlet",""],[3,"ngClass"],["class","block-ui-spinner",4,"ngIf"],[4,"ngIf"],[1,"block-ui-spinner"],[1,"loader"],["class","message",4,"ngIf"],[1,"message"]],template:function(e,i){e&1&&(u(0,"div",1),m(1,H,3,1,"div",2)(2,W,2,0,null,3),h()),e&2&&(D("block-ui-wrapper ",i.name," ",i.className,""),c("ngClass",P(7,q,i.state.blockCount>0)),l(),c("ngIf",!i.templateCmp),l(),c("ngIf",i.templateCmp))},dependencies:[G,z],styles:[`.block-ui-wrapper{display:none;position:fixed;height:100%;width:100%;top:0;left:0;background:rgba(0,0,0,.7);z-index:30000;cursor:wait}.block-ui-wrapper.block-ui-wrapper--element{position:absolute}.block-ui-wrapper.active{display:block}.block-ui-wrapper.block-ui-main{position:fixed}.block-ui-spinner,.block-ui-template{position:absolute;top:40%;margin:0 auto;left:0;right:0;transform:translateY(-50%)}.block-ui-spinner>.message{font-size:1.3em;text-align:center;color:#fff}.block-ui__element{position:relative}.loader,.loader:after{border-radius:50%;width:10em;height:10em}.loader{margin:7px auto;font-size:5px;position:relative;text-indent:-9999em;border-top:1.1em solid rgba(255,255,255,.2);border-right:1.1em solid rgba(255,255,255,.2);border-bottom:1.1em solid rgba(255,255,255,.2);border-left:1.1em solid #ffffff;transform:translateZ(0);animation:load8 1.1s infinite linear}@keyframes load8{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`],encapsulation:2}),t})(),Ie=(()=>{class t{constructor(e){this.blockUI=e}ngOnInit(){this.name=this.name||b,this.template=this.template||this.blockUI.blockUISettings.template}}return t.\u0275fac=function(e){return new(e||t)(p(d))},t.\u0275cmp=g({type:t,selectors:[["block-ui"]],inputs:{name:"name",message:"message",delayStart:"delayStart",delayStop:"delayStop",template:"template"},ngContentSelectors:X,decls:2,vars:5,consts:[[3,"name","message","template","delayStart","delayStop"]],template:function(e,i){e&1&&(M(),j(0),C(1,"block-ui-content",0)),e&2&&(l(),c("name",i.name)("message",i.message)("template",i.template)("delayStart",i.delayStart)("delayStop",i.delayStop))},dependencies:[ee],encapsulation:2}),t})(),te=(()=>{class t{constructor(e){this.blockUIInstance=e,this.globalDispatch=this.blockUIInstance.decorate()}start(e,i){this.dispatch(e,o.START,i)}stop(e){this.dispatch(e,o.STOP)}reset(e){this.dispatch(e,o.RESET)}resetGlobal(){this.globalDispatch.resetGlobal()}update(e,i){this.dispatch(e,o.UPDATE,i)}unsubscribe(e){this.dispatch(e,o.UNSUBSCRIBE)}isActive(e=null){let i=e?this.toArray(e):null,s=this.blockUIInstance.blockUIInstances;return Object.keys(s).some(a=>i?i.indexOf(s[a].name)>=0&&s[a].isActive:s[a].isActive)}dispatch(e=[],i,s){this.toArray(e).forEach($=>this.blockUIInstance.decorate($)[i](s))}toArray(e=[]){return typeof e=="string"?[e]:e}}return t.\u0275fac=function(e){return new(e||t)(B(d))},t.\u0275prov=k({token:t,factory:t.\u0275fac}),t})();var f=new d,Z=new w("BlockUIModuleSettings");function ie(t){return f.updateSettings(t),f}var ge=(()=>{class t{static forRoot(e={}){return{ngModule:t,providers:[{provide:Z,useValue:e},{provide:d,useFactory:ie,deps:[Z]},te]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=R({type:t}),t.\u0275inj=T({imports:[Q]}),t})(),se=1;function Ue(t,n={}){return n.scopeToInstance?function(e,i){let s=`_${i}-block-ui`;Object.defineProperty(e,i,{get:function(){if(this[s])return this[s];let a=`${t}-${se++}`;return this[s]=f.decorate(a),this[s]},set:function(a){this[s]=a}})}:function(e,i){e[i]=f.decorate(t)}}export{Ie as a,ge as b,Ue as c};
