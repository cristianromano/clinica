import{A as n,B as l,C as U,G as g,I as E,N as v,u as m,x as c,z as p}from"./chunk-AON64UGK.js";import{Y as d,ba as f,ca as h,f as s}from"./chunk-CPSHSAPU.js";var j=(()=>{let o=class o{constructor(t){this.firestoreS=t,this.auth=h(m),this.firestore=h(U)}logueado(){return this.auth.currentUser}crearUsuario(t,e,r,i){return s(this,null,function*(){return yield c(this.auth,t,e).then(a=>{p(a.user),l(a.user,{photoURL:r,displayName:i})})})}crearUsuarioAdmin(t,e,r,i){return s(this,null,function*(){return yield c(this.auth,t,e).then(a=>s(this,null,function*(){l(a.user,{photoURL:r,displayName:i})}))})}getUser(){return this.auth.currentUser}esAdmin(){return new Promise((t,e)=>{E(g(this.firestore,"users")).then(r=>{r.forEach(i=>{i.data().email==this.auth.currentUser?.email&&i.data().admin=="true"&&t(!0)})}).catch(r=>{console.error("Error fetching user data:",r),e(!1)})})}logueo(t,e){return s(this,null,function*(){let r=[];if(r=yield this.firestoreS.obtenerFirestoreUsuario(t),r[0].tipo=="profesional"&&r.length>0){let i=yield n(this.auth,t,e),a=this.verificarEmailValidadoProfesional(i);return{autorizado:r[0].autorizado,tipo:r[0].tipo,validado:a}}else if(r[0].tipo=="paciente"&&r.length>0){let i=yield n(this.auth,t,e);return this.verificarEmailValidado(i)}else{yield n(this.auth,t,e);let i;return yield this.firestoreS.obtenerFirestoreUsuarioAdmin(t).then(a=>{a.forEach(w=>{i=w.tipo})}),{tipo:i}}})}verificarEmailValidadoProfesional(t){return t.user.emailVerified}verificarEmailValidado(t){return{validado:t.user.emailVerified,tipo:"paciente"}}signOut(){return this.auth.signOut()}};o.\u0275fac=function(e){return new(e||o)(f(v))},o.\u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"});let u=o;return u})();export{j as a};
