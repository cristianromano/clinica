import{a as he}from"./chunk-XT2GHSXG.js";import{a as w,b as fe}from"./chunk-VFF4UERV.js";import{a as pe,b as me,c as ue}from"./chunk-XL4WQKZB.js";import{b as re,d as ae,h as oe,q as se,r as le,s as xe}from"./chunk-2TE2MQIP.js";import{a as de}from"./chunk-GEZW3YTW.js";import{a as ce}from"./chunk-76VRRPFV.js";import{O as X,Q as Y,R as Z,S as M,T as y,U as ee,W as te,X as P,Y as ie,Z as ne,b as G,c as J,d as K,f as Q}from"./chunk-FWNJSX6N.js";import{$a as I,Ab as T,Da as V,Ga as d,Ha as C,Ua as b,Wa as x,Y as z,Za as i,_a as n,ca as N,cb as v,d as _e,f as j,fb as f,ga as U,gb as h,jb as B,ob as o,pb as u,qa as g,ra as _,sb as R,tb as q,ub as H,vb as A,wb as W,xb as F,yb as S,zb as L}from"./chunk-CPSHSAPU.js";var p=_e(xe());var ge=(()=>{let l=class l{constructor(){this.firestore=N(X)}getPacientes(){return ee(M(this.firestore,"pacientes"))}ingresarTurnoPaciente(t,e,r){return Z(M(this.firestore,"turnos"),{paciente:t,medico:e.nombre+" "+e.apellido,medicoid:e.id,especialidad:e.especialidad,medicoemail:e.email,hora:r,estado:"abierto",fechaPedido:new Date,reseniaOk:!1,calificacion:null,encuesta:null})}obtenerTurnosPorPaciente(t){let e=te(M(this.firestore,"turnos"),ie("paciente","==",t));return Y(e,{idField:"id"})}ingresarEncuesta(t,e){return P(y(this.firestore,"turnos",t),{encuesta:e})}cancelarTurno(t,e){return P(y(this.firestore,"turnos",t),{estado:"cancelado",comentario:e})}ingresarResenia(t,e){return P(y(this.firestore,"turnos",t),{resenia:e,reseniaOk:!0})}ingresarCalificacionMedico(t,e){return P(y(this.firestore,"turnos",t),{calificacion:e})}};l.\u0275fac=function(e){return new(e||l)},l.\u0275prov=z({token:l,factory:l.\u0275fac,providedIn:"root"});let s=l;return s})();var Se=s=>({itemsPerPage:5,currentPage:s,id:"profesionales"}),be=s=>({itemsPerPage:5,currentPage:s,id:"turnos"}),ve=s=>({itemsPerPage:5,currentPage:s,id:"pacientes"});function Te(s,l){if(s&1){let a=v();i(0,"tbody")(1,"tr",17),f("click",function(){let e=g(a).$implicit,r=h(2);return _(r.elegirUsuario(e))}),i(2,"th",18),o(3),n(),i(4,"td"),I(5,"img",19),n(),i(6,"td"),o(7),n(),i(8,"td"),o(9),n()()()}if(s&2){let a=l.$implicit,t=l.index;d(3),u(t+1),d(2),B("src",a.imagenes,V),d(2),u(a.nombre),d(2),u(a.apellido)}}function ye(s,l){if(s&1){let a=v();i(0,"div")(1,"div",15)(2,"h4"),o(3,"Pacientes"),n(),i(4,"div",12)(5,"table",7)(6,"thead")(7,"tr")(8,"th",8),o(9,"#"),n(),i(10,"th",8),o(11,"Foto"),n(),i(12,"th",8),o(13,"Nombre"),n(),i(14,"th",8),o(15,"Apellido"),n()()(),b(16,Te,10,4,"tbody",13),S(17,"paginate"),n(),i(18,"pagination-controls",16),f("pageChange",function(e){g(a);let r=h();return _(r.p3=e)}),n()()()()}if(s&2){let a=h();d(16),x("ngForOf",T(17,1,a.arrPacientes,F(4,ve,a.p3)))}}function Pe(s,l){if(s&1){let a=v();i(0,"tbody",17),f("click",function(){let e=g(a).$implicit,r=h();return _(r.solicitarTurno(e))}),i(1,"tr",20)(2,"th",18),o(3),n(),i(4,"td"),I(5,"img",21),n(),i(6,"td"),o(7),n(),i(8,"td"),o(9),n(),i(10,"td"),o(11),n()()()}if(s&2){let a=l.$implicit,t=l.index;d(),x("ngClass",a.autorizado),d(2),u(t+1),d(2),B("src",a.imagenes,V),d(2),u(a.nombre),d(2),u(a.apellido),d(2),u(a.especialidad)}}function we(s,l){if(s&1){let a=v();i(0,"tbody")(1,"tr",20),S(2,"coloresturnos"),i(3,"th",18),o(4),n(),i(5,"td",17),f("click",function(){let e=g(a).$implicit,r=h();return _(r.manejoTurno(e))}),o(6),n(),i(7,"td",17),f("click",function(){let e=g(a).$implicit,r=h();return _(r.manejoTurno(e))}),o(8),n(),i(9,"td",17),f("click",function(){let e=g(a).$implicit,r=h();return _(r.manejoTurno(e))}),o(10),n(),i(11,"td",17),f("click",function(){let e=g(a).$implicit,r=h();return _(r.manejoTurno(e))}),o(12),n(),i(13,"td")(14,"button",22),f("click",function(){let e=g(a).$implicit,r=h();return _(r.calificarMedico(e))}),o(15," Calificar "),n()(),i(16,"td")(17,"button",22),f("click",function(){let e=g(a).$implicit,r=h();return _(r.realizarEncuesta(e))}),o(18," Encuesta "),n()()()()}if(s&2){let a=l.$implicit,t=l.index;d(),x("ngClass",L(2,8,a.estado)),d(3),u(t+1),d(2),u(a.medico),d(2),u(a.especialidad),d(2),u(a.hora),d(2),u(a.estado),d(2),x("disabled",a.estado!=="realizado"),d(3),x("disabled",a.estado!=="realizado"&&a.comentario!==null)}}var Ae=(()=>{let l=class l{constructor(t,e,r,E,m){this.firestoreS=t,this.filtro=e,this.pacienteS=r,this.authS=E,this.especialistaS=m,this.p=1,this.ptwo=1,this.p3=1,this.arrProfesionales=[],this.arrTurnos=[],this.arrPacientes=[],this.usuarioElegidoEmail="",this.user=[],this.searchEspecialista=""}ngOnInit(){this.firestoreS.obtenerFirestoreTodosProfesional().subscribe(t=>{this.arrProfesionales=[],t.forEach(e=>{this.arrProfesionales.push(e)})}),this.firestoreS.obtenerFirestoreUsuario(this.authS.getUser()?.email).then(t=>{t.length>0&&(this.user=t[0])}),this.firestoreS.obtenerFirestoreTodosPacientes().subscribe(t=>{this.arrPacientes=[],t.forEach(e=>{this.arrPacientes.push(e)})}),console.log(this.authS.getUser()?.email),this.pacienteS.obtenerTurnosPorPaciente(this.authS.getUser()?.email).subscribe(t=>{this.arrTurnos=[],t.forEach(e=>{console.log(e),this.arrTurnos.push(e)})})}elegirUsuario(t){p.default.fire(`Usuario elegido:${t.email}`,"","success"),this.usuarioElegidoEmail=t.email}solicitarTurno(t){let e=new Date,r=[],E=new Date;E.setDate(e.getDate()+15);let m=[];t.horario.forEach(c=>{r.push(new Date(c.seconds*1e3+c.nanoseconds/1e6))}),r.forEach(c=>{c>=e&&c<=E&&m.push(c)});let D={};m.forEach((c,k)=>{D[k.toString()]=`${c.getDate()}/${c.getMonth()} ${c.getHours()}:${c.getMinutes()}`});let $="Horarios disponibles:<br>";Object.keys(D).forEach(c=>{$+=`<input type="radio" id="input${c}" name="hora" value="${c}" required>
               <label for="input${c}">${D[c]}</label><br>`}),m.length>0?p.default.fire({title:"\xBFDesea solicitar turno?",input:"radio",html:$,showDenyButton:!0,confirmButtonText:"Si",denyButtonText:"No",focusConfirm:!1,preConfirm:()=>{let c=document.querySelector('input[name="hora"]:checked')?.value;return c||p.default.showValidationMessage("Seleccione una opci\xF3n"),c}}).then(c=>{let k=m[c.value],O=`${k.getHours()}:${k.getMinutes()}`;console.log(O),c.isConfirmed?(this.pacienteS.ingresarTurnoPaciente(this.usuarioElegidoEmail?this.usuarioElegidoEmail:this.authS.getUser()?.email,t,O),this.usuarioElegidoEmail="",m.splice(c.value,1),this.especialistaS.actualizarHorario(t.id,m),p.default.fire("Turno solicitado","","success")):c.isDenied&&p.default.fire("Turno no solicitado","","info")}):p.default.fire("No hay turnos para este especialista","","error")}calificarMedico(t){if(t.calificacion){p.default.fire("Calificacion ya realizada","","info");return}p.default.fire({title:"Califique al medico",input:"radio",inputOptions:{1:"1",2:"2",3:"3",4:"4",5:"5"},showDenyButton:!0,confirmButtonText:"Calificar",denyButtonText:"No calificar"}).then(e=>{e.isConfirmed?this.pacienteS.ingresarCalificacionMedico(t.id,e.value).then(()=>{p.default.fire(`Calificacion:${e.value}`,"","success")}):e.isDenied&&p.default.fire("Calificacion no realizada","","info")})}realizarEncuesta(t){return j(this,null,function*(){if(t.encuesta){p.default.fire("Encuesta ya realizada","","info");return}let{value:e}=yield p.default.fire({title:"Realice encuesta",input:"text",inputPlaceholder:"Ingrese encuesta",showCancelButton:!0,inputValidator:r=>!r&&"Complete el campo con texto valido"});e?this.pacienteS.ingresarEncuesta(t.id,e).then(()=>{p.default.fire("Encuesta realizada","","success")}):p.default.fire("Encuesta no realizada","","info")})}manejoTurno(t){if(t.estado==="cancelado"){p.default.fire("Turno ya cancelado","","info");return}if(t.estado==="realizado")if(t.reseniaOk===!0){p.default.fire(`Rese\xF1a:${t.comentario}`,"","info");return}else p.default.fire({title:"\xBFDesea agregar rese\xF1a?",showDenyButton:!0,confirmButtonText:"Si",denyButtonText:"No"}).then(e=>{e.isConfirmed?p.default.fire({title:"Ingrese rese\xF1a",input:"text",inputPlaceholder:"Ingrese rese\xF1a",showCancelButton:!0}).then(r=>{r.isConfirmed&&this.pacienteS.ingresarResenia(t.id,r.value).then(()=>{p.default.fire("Rese\xF1a agregada","","success")})}):e.isDenied&&p.default.fire("Rese\xF1a no agregada","","info")});t.estado==="abierto"&&p.default.fire({title:"\xBFDesea cancelar turno? , ingrese motivo:",showDenyButton:!0,confirmButtonText:"Si",denyButtonText:"No",input:"text"}).then(e=>{e.isConfirmed?this.pacienteS.cancelarTurno(t.id,e.value).then(()=>{p.default.fire("Turno cancelado","","success")}):e.isDenied&&p.default.fire("Turno no cancelado","","info")})}filtrarEspecialista(){this.arrProfesionales=this.filtro.transform(this.arrProfesionales,this.searchEspecialista)}};l.\u0275fac=function(e){return new(e||l)(C(ne),C(w),C(ge),C(ce),C(he))},l.\u0275cmp=U({type:l,selectors:[["app-paciente-turnos"]],standalone:!0,features:[A([w]),W],decls:52,vars:17,consts:[[1,"full-background"],[1,"d-flex","flex-row","justify-content-center","align-items-center"],[4,"ngIf"],[1,"d-flex","flex-column","justify-content-center","align-items-center","panelusuarios"],[1,"d-flex","flex-column","justify-content-center","align-items","mt-3"],[1,"mt-1","mb-1"],["type","text","placeholder","Buscar profesional",1,"form-control",3,"ngModelChange","ngModel"],[1,"table"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],["id","profesionales",1,"my-pagination",3,"pageChange"],[1,"card","p-4","shadow","ms-3","mt-3",2,"padding","20px"],[1,"d-flex","flex-column","justify-content-center","align-items-center"],[4,"ngFor","ngForOf"],["id","turnos",1,"my-pagination",3,"pageChange"],[1,"card","p-4","shadow","me-3","mt-3",2,"padding","20px"],["id","pacientes",1,"my-pagination",3,"pageChange"],[3,"click"],["scope","row"],["alt","","srcset","",2,"height","50px","width","50px",3,"src"],[3,"ngClass"],["alt","...",2,"height","50px","width","50px",3,"src"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(e,r){e&1&&(i(0,"div",0),I(1,"app-navbar"),i(2,"div",1),b(3,ye,19,6,"div",2),i(4,"div",3)(5,"div",4)(6,"h4"),o(7,"Buscar por Especialista/Especialidad"),n(),i(8,"div",5)(9,"input",6),H("ngModelChange",function(m){return q(r.searchEspecialista,m)||(r.searchEspecialista=m),m}),n()()(),i(10,"table",7)(11,"thead")(12,"tr")(13,"th",8),o(14,"#"),n(),i(15,"th",8),o(16,"Foto"),n(),i(17,"th",8),o(18,"Nombre"),n(),i(19,"th",8),o(20,"Apellido"),n(),i(21,"th",8),o(22,"Especialidad"),n()()(),b(23,Pe,12,6,"tbody",9),S(24,"filtro"),S(25,"paginate"),n(),i(26,"pagination-controls",10),f("pageChange",function(m){return r.p=m}),n()(),i(27,"div")(28,"div",11)(29,"h4"),o(30,"Turnos"),n(),i(31,"div",12)(32,"table",7)(33,"thead")(34,"tr")(35,"th",8),o(36,"#"),n(),i(37,"th",8),o(38,"Medico"),n(),i(39,"th",8),o(40,"Especialidad"),n(),i(41,"th",8),o(42,"Hora"),n(),i(43,"th",8),o(44,"Estado"),n(),i(45,"th",8),o(46,"Calificar Medico"),n(),i(47,"th",8),o(48,"Encuesta"),n()()(),b(49,we,19,10,"tbody",13),S(50,"paginate"),n(),i(51,"pagination-controls",14),f("pageChange",function(m){return r.ptwo=m}),n()()()()()()),e&2&&(d(3),x("ngIf",r.user.tipo==="administrador"),d(6),R("ngModel",r.searchEspecialista),d(14),x("ngForOf",T(25,7,T(24,4,r.arrProfesionales,r.searchEspecialista),F(13,Se,r.p))),d(26),x("ngForOf",T(50,10,r.arrTurnos,F(15,be,r.ptwo))))},dependencies:[Q,G,J,K,de,le,re,ae,ue,pe,me,se,oe,w,fe],styles:[".full-background[_ngcontent-%COMP%]{width:100vw;height:100vh}[_nghost-%COMP%]{display:block;background-image:url(/assets/pattern.jpg)}.my-pagination[_ngcontent-%COMP%]     .ngx-pagination .current{color:#000}.panelusuarios[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #e9ecef;border-radius:5px;margin-top:10px;padding:50px;background-color:#faebd7;cursor:pointer}.panelturnos[_ngcontent-%COMP%]{border-radius:5px;margin-top:10px;padding:50px;background-color:#faebd7;cursor:pointer}.table[_ngcontent-%COMP%]{width:550px}"]});let s=l;return s})();export{Ae as PacienteTurnosComponent};
