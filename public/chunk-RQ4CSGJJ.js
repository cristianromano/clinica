import{a as me,b as de,c as ce}from"./chunk-AY4PPWRN.js";import{a as pe,c as ue,d as fe,e as ge,f as he}from"./chunk-5JGJFHZR.js";import{a as H,b as J,c as d,d as K,e as Q,f as I,g,h as X,i as Y,j as ee,k as te,l as ie,m as re,n as oe,o as ne,p as ae,q as le,r as se}from"./chunk-4DSXN4JZ.js";import{a as be}from"./chunk-PAPPUINV.js";import"./chunk-S24AL736.js";import{F as j,J as L,L as z,M as Z,N as w,P as W,Q as $,c as O,d as D,e as q,i as G}from"./chunk-XGQUN4LM.js";import{$a as h,Ga as m,Ha as S,Ua as f,Wa as c,Za as r,_a as i,ab as T,bb as b,ca as C,cb as E,d as ve,f as y,ga as k,jb as a,lb as R,mb as V,nb as M,ob as P,qa as A,qb as B,ra as U,s as N}from"./chunk-WIFXGSG2.js";var v=ve(be());function _e(o,n){o&1&&(r(0,"div",31),a(1," El nombre solo acepta letras. "),i())}function xe(o,n){o&1&&(r(0,"div",31),a(1," El apellido solo acepta letras. "),i())}function Ce(o,n){o&1&&(r(0,"div",31),a(1," La edad debe estar en el rango de 18 a 99. "),i())}function Ee(o,n){o&1&&(r(0,"div",31),a(1," El DNI debe tener al menos 8 d\xEDgitos. "),i())}function ye(o,n){o&1&&(r(0,"div",31),a(1," la obra social debe contener texto. "),i())}function Se(o,n){if(o&1&&(r(0,"div",8)(1,"label",32),a(2,"Obra social"),i(),h(3,"input",33),f(4,ye,2,0,"div",11),i()),o&2){let t,e=E();m(4),c("ngIf",e.formRegistro==null||(t=e.formRegistro.get("obrasocial"))==null||t.errors==null?null:t.errors.pattern)}}function Re(o,n){if(o&1&&(r(0,"option",37),a(1),i()),o&2){let t=n.$implicit;c("value",t.valor),m(),R(" ",t.etiqueta," ")}}function we(o,n){if(o&1&&(r(0,"div",8)(1,"label",34),a(2,"Especialidad"),i(),r(3,"select",35),f(4,Re,2,2,"option",36),i()()),o&2){let t=E();m(4),c("ngForOf",t.opciones)}}function Ie(o,n){o&1&&(r(0,"div",31),a(1," ingrese un email valido. "),i())}function Fe(o,n){if(o&1&&(r(0,"li",38),a(1),i()),o&2){let t=n.$implicit;m(),R(" ",t.name," ")}}function Ne(o,n){o&1&&(r(0,"div",44),a(1," Este campo solo puede contener letras y espacios. "),i())}function ke(o,n){if(o&1){let t=T();r(0,"form",39),b("ngSubmit",function(){A(t);let l=E();return U(l.agregarEspecialidad())}),r(1,"label",40),a(2,"Agregar especialidad"),i(),h(3,"input",41),f(4,Ne,2,0,"div",42),r(5,"button",43),a(6," Agregar a lista "),i()()}if(o&2){let t,e=E();c("formGroup",e.formEspecialidad),m(4),c("ngIf",(t=e.formEspecialidad.get("especialidadextra"))==null||t.errors==null?null:t.errors.pattern),m(),c("disabled",!(e.formEspecialidad!=null&&e.formEspecialidad.valid))}}var _=class _{constructor(n,t,e){this.formBuilder=n,this.firestoreService=t,this.authService=e,this.opciones=[],this.storage=C(pe),this.firestore=C(L),this.auth=C(j),this.storageUpload=fe(),this.savedFileNames=[],this.tipoUsuario="Paciente",this.isChecked=!1,this.router=C(G),this.formRegistro=new I({nombre:new g("",[d.required,d.pattern("[a-zA-Z ]*")]),apellido:new g("",[d.required,d.pattern("[a-zA-Z ]*")]),edad:new g("",[d.required,d.pattern("[0-9]*"),d.min(18),d.max(99)]),dni:new g("",[d.required,d.minLength(8),d.maxLength(8)]),obrasocial:new g("",[d.required,d.pattern("[a-zA-Z ]*")]),email:new g("",[d.required,d.pattern("[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}")]),especialidad:new g(""),password:new g("",[d.required]),imagenes:this.formBuilder.array([])}),this.formEspecialidad=new I({especialidadextra:new g("",[d.pattern("[a-zA-Z ]*")])})}ngOnInit(){z(w(this.firestore,"especialidades")).subscribe(n=>{this.opciones=[],n.forEach(t=>{this.opciones.push({etiqueta:t.especialidad,valor:t.especialidad})})})}submitForm(){return y(this,null,function*(){this.blockUI.start("Ingresando datos a la base de datos...");let n=this.formRegistro.get("imagenes"),t=[];for(let p of n.controls)if(p.value!==""){let u=ge(this.storage,`imagenes/${p.value.name}`);yield he(u,p.value).then(x=>y(this,null,function*(){t.push(yield ue(x.ref))}))}let e=this.formRegistro.get("email")?.value,l=this.formRegistro.get("password")?.value,s=this.formRegistro.get("nombre")?.value;this.tipoUsuario==="Paciente"?e&&l&&s&&this.authService.crearUsuario(e,l,t[0],s).then(p=>{this.firestoreService.agregarFirestorePaciente(this.formRegistro,t[0]).then(()=>{this.blockUI.stop(),this.savedFileNames=[],this.formRegistro.reset(),v.default.fire({title:"Registro exitoso",text:"Se ha registrado correctamente",icon:"success",confirmButtonText:"Aceptar"})})}).catch(p=>{this.blockUI.stop();let u=this.firebaseErrors(p.code);v.default.fire({title:"Error",text:u,icon:"error",confirmButtonText:"Aceptar"})}):e&&l&&s&&this.authService.crearUsuario(e,l,t[0],s).then(p=>{this.firestoreService.agregarFirestoreProfesional(this.formRegistro,t).then(()=>{this.blockUI.stop(),this.savedFileNames=[],this.formRegistro.reset(),v.default.fire({title:"Registro exitoso",text:"Se ha registrado correctamente",icon:"success",confirmButtonText:"Aceptar"})})}).catch(p=>{this.blockUI.stop();let u=this.firebaseErrors(p.code);v.default.fire({title:"Error",text:u,icon:"error",confirmButtonText:"Aceptar"})})})}agregarEspecialidad(){return y(this,null,function*(){let n;this.blockUI.start("Agregando especialidad...");let t=this.formEspecialidad.get("especialidadextra")?.value;t&&(n=yield this.firestoreService.obtenerFirestoreEspecialidades(t)),n?(this.blockUI.stop(),v.default.fire({title:"Error",text:"La especialidad ya existe",icon:"error",confirmButtonText:"Aceptar"})):this.formEspecialidad.get("especialidadextra")?.value!==""?Z(w(this.firestore,"especialidades"),{especialidad:this.formEspecialidad.get("especialidadextra")?.value}).then(()=>{this.blockUI.stop(),v.default.fire({title:"Especialidad agregada",text:"Se ha agregado la especialidad correctamente",icon:"success",confirmButtonText:"Aceptar"}),this.formEspecialidad.reset()}):(this.blockUI.stop(),v.default.fire({title:"Error",text:"Debe ingresar una especialidad",icon:"error",confirmButtonText:"Aceptar"}))})}onFileChange(n){let t=n.target.files;if(t){let e=this.formRegistro.get("imagenes");for(let l=0;l<t.length;l++)if(this.tipoUsuario==="Paciente"){this.savedFileNames=[],e.removeAt(0);let s=t[l];this.savedFileNames.push({name:s.name}),e.push(this.formBuilder.control(s))}else if(this.tipoUsuario==="Profesional"){console.log(this.savedFileNames.length),this.savedFileNames.length>1&&(this.savedFileNames.pop(),e.removeAt(1));let s=t[l];this.savedFileNames.push({name:s.name}),e.push(this.formBuilder.control(s))}}}onCheckboxChange(){this.formRegistro.reset(),this.savedFileNames=[],this.isChecked?(this.tipoUsuario="Profesional",this.formRegistro.get("obrasocial")?.clearValidators(),this.formRegistro.get("obrasocial")?.updateValueAndValidity(),this.formRegistro.get("especialidad")?.addValidators(d.required),this.formRegistro.get("especialidad")?.updateValueAndValidity()):(this.tipoUsuario="Paciente",this.formRegistro.get("especialidad")?.clearValidators(),this.formRegistro.get("especialidad")?.updateValueAndValidity(),this.formRegistro.get("obrasocial")?.addValidators(d.required),this.formRegistro.get("obrasocial")?.updateValueAndValidity())}irLogin(){this.router.navigate(["/login"])}firebaseErrors(n){switch(n){case"auth/email-already-in-use":return"Direcci\xF3n de correo electr\xF3nico en uso.";case"auth/weak-password":return"contrase\xF1a debil ingrese una mas segura.";case"auth/user-not-found":return"Usuario no encontrado.";case"auth/invalid-credential":return"Credenciales invalidas.";default:return"Ocurri\xF3 un error. Por favor, int\xE9ntelo nuevamente m\xE1s tarde."}}};_.\u0275fac=function(t){return new(t||_)(S(ae),S(W),S($))},_.\u0275cmp=k({type:_,selectors:[["app-registro"]],standalone:!0,features:[B],decls:58,vars:13,consts:[[1,"full-background"],[1,"container-fluid","d-flex","justify-content-evenly","align-items-center"],[1,"card","p-4","shadow","mt-3",2,"width","30rem"],[1,"form-check","form-switch","me-5"],["role","alert",1,"alert","alert-danger","d-flex","flex-column","justify-content-center","align-items-center"],["type","checkbox","role","switch","id","flexSwitchCheckDefault",1,"form-check-input",2,"height","30px","width","50px",3,"ngModelChange","ngModel"],[1,"text-center","mb-4","mt-1"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","nombre",1,"form-label"],["type","text","id","nombre","formControlName","nombre",1,"form-control"],["class","text-danger",4,"ngIf"],["type","text","id","apellido","formControlName","apellido",1,"form-control"],["for","edad",1,"form-label"],["type","number","id","edad","formControlName","edad",1,"form-control"],["for","dni",1,"form-label"],["type","text","id","dni","formControlName","dni",1,"form-control"],["class","mb-3",4,"ngIf"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email",1,"form-control"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password",1,"form-control"],[1,"d-flex","justify-content-center","align-items-center"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button",1,"btn","btn-success","ms-3",3,"click"],[1,"mb-3","card","p-4","shadow"],["for","imagenes",1,"form-label"],["type","file","id","imagenes","multiple","","accept","image/*","formControlName","imagenes",1,"form-control",3,"change"],[1,"saved-files"],["class","text-success",4,"ngFor","ngForOf"],["class","mb-3 card p-4 shadow",3,"formGroup","ngSubmit",4,"ngIf"],[1,"text-danger"],["for","obrasocial",1,"form-label"],["type","text","id","obrasocial","formControlName","obrasocial",1,"form-control"],["for","especialidad",1,"form-label"],["id","especialidad","formControlName","especialidad",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"text-success"],[1,"mb-3","card","p-4","shadow",3,"ngSubmit","formGroup"],["for","especialidadextra",1,"form-label"],["type","text","id","especialidadextra","formControlName","especialidadextra",1,"form-control"],["style","color: red","class","mt-2",4,"ngIf"],["type","submit",1,"btn","btn-primary","mt-3",3,"disabled"],[1,"mt-2",2,"color","red"]],template:function(t,e){if(t&1&&(r(0,"block-ui")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),a(6," Aprete para cambiar de formulario. "),r(7,"input",5),P("ngModelChange",function(s){return M(e.isChecked,s)||(e.isChecked=s),s}),b("ngModelChange",function(){return e.onCheckboxChange()}),i()()(),r(8,"h2",6),a(9),i(),r(10,"form",7),b("ngSubmit",function(){return e.submitForm()}),r(11,"div",8)(12,"label",9),a(13,"Nombre:"),i(),h(14,"input",10),f(15,_e,2,0,"div",11),i(),r(16,"div",8)(17,"label",9),a(18,"Apellido:"),i(),h(19,"input",12),f(20,xe,2,0,"div",11),i(),r(21,"div",8)(22,"label",13),a(23,"Edad:"),i(),h(24,"input",14),f(25,Ce,2,0,"div",11),i(),r(26,"div",8)(27,"label",15),a(28,"DNI:"),i(),h(29,"input",16),f(30,Ee,2,0,"div",11),i(),f(31,Se,5,1,"div",17)(32,we,5,1,"div",17),r(33,"div",8)(34,"label",18),a(35,"Email"),i(),h(36,"input",19),i(),f(37,Ie,2,0,"div",11),r(38,"div",8)(39,"label",20),a(40,"Contrase\xF1a"),i(),h(41,"input",21),i(),r(42,"div",22)(43,"button",23),a(44," Guardar datos "),i(),r(45,"button",24),b("click",function(){return e.irLogin()}),a(46," Ir a ingreso "),i()()()(),r(47,"div")(48,"div",25)(49,"label",26),a(50,"Imagenes"),i(),r(51,"input",27),b("change",function(s){return e.onFileChange(s)}),i(),r(52,"div",28)(53,"h5"),a(54,"Archivos cargados:"),i(),r(55,"ul"),f(56,Fe,2,1,"li",29),i()()(),f(57,ke,7,3,"form",30),i()()()()),t&2){let l,s,p,u,x;m(7),V("ngModel",e.isChecked),m(2),R("Formulario de ",e.tipoUsuario,""),m(),c("formGroup",e.formRegistro),m(5),c("ngIf",e.formRegistro==null||(l=e.formRegistro.get("nombre"))==null||l.errors==null?null:l.errors.pattern),m(5),c("ngIf",e.formRegistro==null||(s=e.formRegistro.get("apellido"))==null||s.errors==null?null:s.errors.pattern),m(5),c("ngIf",(e.formRegistro==null||(p=e.formRegistro.get("edad"))==null||p.errors==null?null:p.errors.min)||(e.formRegistro==null||(p=e.formRegistro.get("edad"))==null||p.errors==null?null:p.errors.max)),m(5),c("ngIf",((u=e.formRegistro.get("dni"))==null||u.errors==null?null:u.errors.minlength)||((u=e.formRegistro.get("dni"))==null||u.errors==null?null:u.errors.maxlength)),m(),c("ngIf",e.tipoUsuario=="Paciente"),m(),c("ngIf",e.tipoUsuario=="Profesional"),m(5),c("ngIf",e.formRegistro==null||(x=e.formRegistro.get("email"))==null||x.errors==null?null:x.errors.pattern),m(6),c("disabled",!(e.formRegistro!=null&&e.formRegistro.valid)||!e.savedFileNames.length),m(13),c("ngForOf",e.savedFileNames),m(),c("ngIf",e.tipoUsuario==="Profesional")}},dependencies:[se,Y,oe,ne,J,ee,H,re,K,Q,te,ie,q,O,D,le,X,de,me],styles:["[_nghost-%COMP%]{display:block;background-image:url(/assets/pattern.jpg)}.full-background[_ngcontent-%COMP%]{width:100vw;height:100vh}.saved-files[_ngcontent-%COMP%]{margin-top:20px}.text-success[_ngcontent-%COMP%]{color:green;font-weight:700}.ms-5[_ngcontent-%COMP%]{margin-left:150px!important}"]});var F=_;N([ce()],F.prototype,"blockUI",void 0);export{F as RegistroComponent};
