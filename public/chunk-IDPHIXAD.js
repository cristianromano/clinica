import{c as ue,d as fe,e as ge}from"./chunk-GVBCGJ22.js";import{a as se,c as me,d as de,e as ce,f as pe}from"./chunk-QNMXYADB.js";import{a as oe,b as ae,c as ne}from"./chunk-TTWCWHL6.js";import{a as ve}from"./chunk-KURMSICS.js";import{a as K,b as d,c as J,d as Q,e as k,f as h,h as Y,i as W,j as X,k as ee,o as te,p as ie,q as re}from"./chunk-JX2K3NFS.js";import"./chunk-UAHUDWA7.js";import{a as le}from"./chunk-GN3YVZHB.js";import{C as L,E as Z,G as $,H as N,O as H,u as z}from"./chunk-PLM2N6DR.js";import{b as M,c as D,d as j,h as q,l as G,n as P}from"./chunk-BWXJFDZ4.js";import{$a as g,Ga as m,Ha as y,Ua as f,Wa as p,Za as o,_a as i,ca as _,cb as I,d as he,f as C,fb as b,ga as V,gb as x,ob as n,pb as A,qa as S,qb as F,ra as w,s as T,wb as B,xb as O}from"./chunk-CPSHSAPU.js";var v=he(ve());var be=a=>({"table-primary":a});function _e(a,r){a&1&&(o(0,"div",34),n(1," El nombre solo acepta letras. "),i())}function xe(a,r){a&1&&(o(0,"div",34),n(1," El apellido solo acepta letras. "),i())}function Ee(a,r){a&1&&(o(0,"div",34),n(1," La edad debe estar en el rango de 18 a 99. "),i())}function Re(a,r){a&1&&(o(0,"div",34),n(1," El DNI debe tener al menos 8 d\xEDgitos. "),i())}function ye(a,r){a&1&&(o(0,"div",34),n(1," la obra social debe contener texto. "),i())}function Ce(a,r){if(a&1&&(o(0,"div",5)(1,"label",35),n(2,"Obra social"),i(),g(3,"input",36),f(4,ye,2,0,"div",8),i()),a&2){let t,e=x();m(4),p("ngIf",e.formRegistro==null||(t=e.formRegistro.get("obrasocial"))==null||t.errors==null?null:t.errors.pattern)}}function Se(a,r){a&1&&(o(0,"div",34),n(1," ingrese un email valido. "),i())}function we(a,r){if(a&1){let t=I();o(0,"tbody",37),b("click",function(){let l=S(t),s=l.$implicit,c=l.index,u=x();return w(u.getEspecialidadesOpciones(s.valor,c))}),o(1,"tr",38)(2,"th",39),n(3),i(),o(4,"td"),n(5),i()()()}if(a&2){let t=r.$implicit,e=r.index,l=x();m(),p("ngClass",O(3,be,l.selectedRow===e)),m(2),A(e+1),m(2),A(t.valor)}}function Ie(a,r){if(a&1&&(o(0,"li",40),n(1),i()),a&2){let t=r.$implicit;m(),F(" ",t.name," ")}}function Ae(a,r){a&1&&(o(0,"div",46),n(1," Este campo solo puede contener letras y espacios. "),i())}function Fe(a,r){if(a&1){let t=I();o(0,"form",41),b("ngSubmit",function(){S(t);let l=x();return w(l.agregarEspecialidad())}),o(1,"label",42),n(2,"Agregar especialidad"),i(),g(3,"input",43),f(4,Ae,2,0,"div",44),o(5,"button",45),n(6," Agregar a lista "),i()()}if(a&2){let t,e=x();p("formGroup",e.formEspecialidad),m(4),p("ngIf",(t=e.formEspecialidad.get("especialidadextra"))==null||t.errors==null?null:t.errors.pattern),m(),p("disabled",!(e.formEspecialidad!=null&&e.formEspecialidad.valid))}}var E=class E{constructor(r,t,e,l){this.formBuilder=r,this.firestoreService=t,this.authService=e,this.route=l,this.opciones=[],this.storage=_(se),this.firestore=_(L),this.auth=_(z),this.storageUpload=de(),this.token="",this.recaptchaV3Service=_(ge),this.savedFileNames=[],this.tipoUsuario="",this.isChecked=!1,this.router=_(P),this.formRegistro=new k({nombre:new h("",[d.required,d.pattern("[a-zA-Z ]*")]),apellido:new h("",[d.required,d.pattern("[a-zA-Z ]*")]),edad:new h("",[d.required,d.pattern("[0-9]*"),d.min(18),d.max(99)]),dni:new h("",[d.required,d.minLength(8),d.maxLength(8)]),obrasocial:new h("",[d.required,d.pattern("[a-zA-Z ]*")]),email:new h("",[d.required,d.pattern("[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}")]),especialidad:this.formBuilder.array([]),password:new h("",[d.required]),imagenes:this.formBuilder.array([])}),this.formEspecialidad=new k({especialidadextra:new h("",[d.pattern("[a-zA-Z ]*")])}),this.route.paramMap.subscribe(s=>{this.tipoUsuario=s.get("usuario")})}ngOnInit(){Z(N(this.firestore,"especialidades")).subscribe(r=>{this.opciones=[],r.forEach(t=>{this.opciones.push({etiqueta:t.especialidad,valor:t.especialidad})})}),this.onCheckboxChange()}executeReCaptchaV3(r){this.token=r}abc(r){console.log(r)}getEspecialidadesOpciones(r,t){this.selectedRow=t,v.default.fire({title:`Especialidad ${r} agregada`,text:r,icon:"success",confirmButtonText:"Aceptar"}),this.formRegistro.get("especialidad"),this.formRegistro.get("especialidad").push(this.formBuilder.control(r)),console.log(this.formRegistro.value.especialidad)}submitForm(){return C(this,null,function*(){this.blockUI.start("Ingresando datos a la base de datos...");let r=this.formRegistro.get("imagenes"),t=[];for(let c of r.controls)if(c.value!==""){let u=ce(this.storage,`imagenes/${c.value.name}`);yield pe(u,c.value).then(R=>C(this,null,function*(){t.push(yield me(R.ref))}))}let e=this.formRegistro.get("email")?.value,l=this.formRegistro.get("password")?.value,s=this.formRegistro.get("nombre")?.value;this.tipoUsuario==="paciente"?e&&l&&s&&this.authService.crearUsuario(e,l,t[0],s).then(c=>{this.firestoreService.agregarFirestorePaciente(this.formRegistro,t[0]).then(()=>{this.blockUI.stop(),this.savedFileNames=[],this.formRegistro.reset(),v.default.fire({title:"Registro exitoso",text:"Se ha registrado correctamente",icon:"success",confirmButtonText:"Aceptar"})})}).catch(c=>{this.blockUI.stop();let u=this.firebaseErrors(c.code);v.default.fire({title:"Error",text:u,icon:"error",confirmButtonText:"Aceptar"})}):e&&l&&s&&(console.log(this.formRegistro.value),this.authService.crearUsuario(e,l,t[0],s).then(c=>{this.firestoreService.agregarFirestoreProfesional(this.formRegistro,t).then(()=>{this.blockUI.stop(),this.savedFileNames=[],this.formRegistro.reset(),v.default.fire({title:"Registro exitoso",text:"Se ha registrado correctamente",icon:"success",confirmButtonText:"Aceptar"})}),this.router.navigate(["/elegirusuario"])}).catch(c=>{this.blockUI.stop();let u=this.firebaseErrors(c.code);v.default.fire({title:"Error",text:u,icon:"error",confirmButtonText:"Aceptar"})}))})}agregarEspecialidad(){return C(this,null,function*(){let r;this.blockUI.start("Agregando especialidad...");let t=this.formEspecialidad.get("especialidadextra")?.value;t&&(r=yield this.firestoreService.obtenerFirestoreEspecialidades(t)),r?(this.blockUI.stop(),v.default.fire({title:"Error",text:"La especialidad ya existe",icon:"error",confirmButtonText:"Aceptar"})):this.formEspecialidad.get("especialidadextra")?.value!==""?$(N(this.firestore,"especialidades"),{especialidad:this.formEspecialidad.get("especialidadextra")?.value}).then(()=>{this.blockUI.stop(),v.default.fire({title:"Especialidad agregada",text:"Se ha agregado la especialidad correctamente",icon:"success",confirmButtonText:"Aceptar"}),this.formEspecialidad.reset()}):(this.blockUI.stop(),v.default.fire({title:"Error",text:"Debe ingresar una especialidad",icon:"error",confirmButtonText:"Aceptar"}))})}onFileChange(r){let t=r.target.files;if(t){let e=this.formRegistro.get("imagenes");for(let l=0;l<t.length;l++)if(this.tipoUsuario==="paciente"){this.savedFileNames=[],e.removeAt(0);let s=t[l];this.savedFileNames.push({name:s.name}),e.push(this.formBuilder.control(s))}else if(this.tipoUsuario==="especialista"){console.log(this.savedFileNames.length),this.savedFileNames.length>1&&(this.savedFileNames.pop(),e.removeAt(1));let s=t[l];this.savedFileNames.push({name:s.name}),e.push(this.formBuilder.control(s))}}}onCheckboxChange(){this.savedFileNames=[],this.tipoUsuario==="especialista"?(this.formRegistro.get("obrasocial")?.clearValidators(),this.formRegistro.get("obrasocial")?.updateValueAndValidity(),this.formRegistro.get("especialidad")?.addValidators(d.required),this.formRegistro.get("especialidad")?.updateValueAndValidity()):(this.formRegistro.get("especialidad")?.clearValidators(),this.formRegistro.get("especialidad")?.updateValueAndValidity(),this.formRegistro.get("obrasocial")?.addValidators(d.required),this.formRegistro.get("obrasocial")?.updateValueAndValidity())}irLogin(){this.router.navigate(["/login"])}firebaseErrors(r){switch(r){case"auth/email-already-in-use":return"Direcci\xF3n de correo electr\xF3nico en uso.";case"auth/weak-password":return"contrase\xF1a debil ingrese una mas segura.";case"auth/user-not-found":return"Usuario no encontrado.";case"auth/invalid-credential":return"Credenciales invalidas.";default:return"Ocurri\xF3 un error. Por favor, int\xE9ntelo nuevamente m\xE1s tarde."}}};E.\u0275fac=function(t){return new(t||E)(y(te),y(H),y(le),y(G))},E.\u0275cmp=V({type:E,selectors:[["app-registro"]],standalone:!0,features:[B],decls:65,vars:12,consts:[[1,"full-background"],[1,"container-fluid","d-flex","justify-content-evenly","align-items-center"],[1,"card","p-4","shadow","mt-3",2,"width","30rem"],[1,"text-center","mb-4","mt-1"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","nombre",1,"form-label"],["type","text","id","nombre","formControlName","nombre",1,"form-control"],["class","text-danger",4,"ngIf"],["type","text","id","apellido","formControlName","apellido",1,"form-control"],["for","edad",1,"form-label"],["type","number","id","edad","formControlName","edad",1,"form-control"],["for","dni",1,"form-label"],["type","text","id","dni","formControlName","dni",1,"form-control"],["class","mb-3",4,"ngIf"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email",1,"form-control"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password",1,"form-control"],["siteKey","6LdpHxIpAAAAAH-zYajIe3KgGwpte23vuDHQixJK",1,"d-flex","justify-content-center","align-items-center","mb-3",3,"resolved"],[1,"d-flex","justify-content-center","align-items-center"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button",1,"btn","btn-success","ms-3",3,"click"],[1,"mb-3","card","p-4","shadow","mt-3"],[1,"d-flex","flex-row","justify-content-center","allign-item-center"],[1,"table"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],[1,"mb-3","card","p-4","shadow","me-3"],["for","imagenes",1,"form-label"],["type","file","id","imagenes","multiple","","accept","image/*","formControlName","imagenes",1,"form-control",3,"change"],[1,"saved-files"],["class","text-success",4,"ngFor","ngForOf"],["class","mb-3 card p-4 shadow",3,"formGroup","ngSubmit",4,"ngIf"],[1,"text-danger"],["for","obrasocial",1,"form-label"],["type","text","id","obrasocial","formControlName","obrasocial",1,"form-control"],[3,"click"],[3,"ngClass"],["scope","row"],[1,"text-success"],[1,"mb-3","card","p-4","shadow",3,"ngSubmit","formGroup"],["for","especialidadextra",1,"form-label"],["type","text","id","especialidadextra","formControlName","especialidadextra",1,"form-control"],["style","color: red","class","mt-2",4,"ngIf"],["type","submit",1,"btn","btn-primary","mt-3",3,"disabled"],[1,"mt-2",2,"color","red"]],template:function(t,e){if(t&1&&(o(0,"block-ui")(1,"div",0)(2,"div",1)(3,"div",2)(4,"h2",3),n(5),i(),o(6,"form",4),b("ngSubmit",function(){return e.submitForm()}),o(7,"div",5)(8,"label",6),n(9,"Nombre:"),i(),g(10,"input",7),f(11,_e,2,0,"div",8),i(),o(12,"div",5)(13,"label",6),n(14,"Apellido:"),i(),g(15,"input",9),f(16,xe,2,0,"div",8),i(),o(17,"div",5)(18,"label",10),n(19,"Edad:"),i(),g(20,"input",11),f(21,Ee,2,0,"div",8),i(),o(22,"div",5)(23,"label",12),n(24,"DNI:"),i(),g(25,"input",13),f(26,Re,2,0,"div",8),i(),f(27,Ce,5,1,"div",14),o(28,"div",5)(29,"label",15),n(30,"Email"),i(),g(31,"input",16),i(),f(32,Se,2,0,"div",8),o(33,"div",5)(34,"label",17),n(35,"Contrase\xF1a"),i(),g(36,"input",18),i(),o(37,"re-captcha",19),b("resolved",function(s){return e.executeReCaptchaV3(s)}),i(),o(38,"div",20)(39,"button",21),n(40," Guardar datos "),i(),o(41,"button",22),b("click",function(){return e.irLogin()}),n(42," Ir a ingreso "),i()()()(),o(43,"div")(44,"div",23)(45,"div",24)(46,"table",25)(47,"thead")(48,"tr")(49,"th",26),n(50,"#"),i(),o(51,"th",26),n(52,"Especialidad"),i()()(),f(53,we,6,5,"tbody",27),i()()(),o(54,"div",24)(55,"div",28)(56,"label",29),n(57,"Imagenes"),i(),o(58,"input",30),b("change",function(s){return e.onFileChange(s)}),i(),o(59,"div",31)(60,"h5"),n(61,"Archivos cargados:"),i(),o(62,"ul"),f(63,Ie,2,1,"li",32),i()()(),f(64,Fe,7,3,"form",33),i()()()()()),t&2){let l,s,c,u,R;m(5),F(" Formulario de ",e.tipoUsuario," "),m(),p("formGroup",e.formRegistro),m(5),p("ngIf",e.formRegistro==null||(l=e.formRegistro.get("nombre"))==null||l.errors==null?null:l.errors.pattern),m(5),p("ngIf",e.formRegistro==null||(s=e.formRegistro.get("apellido"))==null||s.errors==null?null:s.errors.pattern),m(5),p("ngIf",(e.formRegistro==null||(c=e.formRegistro.get("edad"))==null||c.errors==null?null:c.errors.min)||(e.formRegistro==null||(c=e.formRegistro.get("edad"))==null||c.errors==null?null:c.errors.max)),m(5),p("ngIf",((u=e.formRegistro.get("dni"))==null||u.errors==null?null:u.errors.minlength)||((u=e.formRegistro.get("dni"))==null||u.errors==null?null:u.errors.maxlength)),m(),p("ngIf",e.tipoUsuario=="paciente"),m(5),p("ngIf",e.formRegistro==null||(R=e.formRegistro.get("email"))==null||R.errors==null?null:R.errors.pattern),m(7),p("disabled",!(e.formRegistro!=null&&e.formRegistro.valid)||!e.savedFileNames.length||!e.token),m(14),p("ngForOf",e.opciones),m(10),p("ngForOf",e.savedFileNames),m(),p("ngIf",e.tipoUsuario==="especialista")}},dependencies:[re,Y,K,W,J,Q,X,ee,q,M,D,j,ie,ae,oe,fe,ue],styles:["[_nghost-%COMP%]{display:block;background-image:url(/assets/pattern.jpg)}.full-background[_ngcontent-%COMP%]{width:100vw;height:100vh}.saved-files[_ngcontent-%COMP%]{margin-top:20px}.text-success[_ngcontent-%COMP%]{color:green;font-weight:700}.ms-5[_ngcontent-%COMP%]{margin-left:150px!important}.table[_ngcontent-%COMP%]{cursor:pointer}"]});var U=E;T([ne()],U.prototype,"blockUI",void 0);export{U as RegistroComponent};
