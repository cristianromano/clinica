import{a as oe}from"./chunk-RLNOM6ZC.js";import{a as w,b as re}from"./chunk-6ZRPZ7NW.js";import{a as ee}from"./chunk-L7GHGVGE.js";import{a as Z}from"./chunk-E4UZH4GH.js";import{a as te,b as ie,c as ne}from"./chunk-V4624JQ6.js";import{a as se}from"./chunk-7VGHOT3T.js";import{p as K,q as Q}from"./chunk-IDY3ZXSF.js";import{a as X}from"./chunk-WJSC7PN5.js";import{a as W}from"./chunk-RBADOQRF.js";import{C as L,E as Y,H as G,P as J}from"./chunk-IXUCQNA3.js";import{c as R,d as U,h as q,j as A}from"./chunk-YW5BT2SR.js";import{$ as I,Cb as H,Da as B,Db as N,Fb as E,Ha as p,Hb as x,Ia as b,Ib as k,Jb as T,Wa as C,Ya as m,cb as n,da as $,db as o,eb as P,ib as y,lb as u,mb as d,na as _,oa as g,pb as z,vb as c,wb as v,xb as S}from"./chunk-LTJRTMYM.js";import{a as M,e as ae,g as j}from"./chunk-5G567QLT.js";var s=ae(se());var ce=a=>({itemsPerPage:5,currentPage:a,id:"profesionales"}),le=a=>({itemsPerPage:5,currentPage:a,id:"turnos"}),D=a=>({"table-primary":a});function pe(a,l){if(a&1){let r=y();n(0,"tbody",15),u("click",function(){let t=_(r),i=t.$implicit,f=t.index,h=d();return g(h.getEspecialidadesOpciones(i.valor,f))}),n(1,"tr",16)(2,"td",2)(3,"button",17),P(4,"img",18),o()()()()}if(a&2){let r=l.$implicit,e=l.index,t=d();p(),m("ngClass",E(2,D,t.selectedRow===e)),p(3),m("src",r.foto,B)}}function de(a,l){if(a&1){let r=y();n(0,"tbody",15),u("click",function(){let t=_(r).$implicit,i=d();return g(i.elegirMedico(t))}),n(1,"tr")(2,"td")(3,"button",17),P(4,"img",19)(5,"br"),c(6),o()()()()}if(a&2){let r=l.$implicit;p(4),z("src",r.imagenes,B),p(2),S(" ",r.nombre," ")}}function me(a,l){if(a&1){let r=y();n(0,"tr",20),u("click",function(){let t=_(r).$implicit,i=d();return g(i.elegirHorario(t))}),n(1,"td")(2,"button",21),c(3),o()()()}if(a&2){let r=l.$implicit,e=l.index,t=d();m("ngClass",E(2,D,t.selectedRow===e)),p(3),S(" ",r.fecha," ")}}function ue(a,l){if(a&1){let r=y();n(0,"tr",20),u("click",function(){let t=_(r).$implicit,i=d();return g(i.solicitarTurno(t))}),n(1,"td")(2,"button",21),c(3),x(4,"convertirfecha"),x(5,"date"),o()()()}if(a&2){let r=l.$implicit,e=l.index,t=d();m("ngClass",E(7,D,t.selectedRow===e)),p(3),S(" ",T(5,4,k(4,2,r.timestamp),"shortTime")," ")}}function fe(a,l){if(a&1){let r=y();n(0,"tbody")(1,"tr",16),x(2,"coloresturnos"),n(3,"th",22),c(4),o(),n(5,"td",15),u("click",function(){let t=_(r).$implicit,i=d();return g(i.manejoTurno(t))}),c(6),o(),n(7,"td",15),u("click",function(){let t=_(r).$implicit,i=d();return g(i.manejoTurno(t))}),c(8),o(),n(9,"td",15),u("click",function(){let t=_(r).$implicit,i=d();return g(i.manejoTurno(t))}),c(10),x(11,"convertirfecha"),x(12,"date"),o(),n(13,"td",15),u("click",function(){let t=_(r).$implicit,i=d();return g(i.manejoTurno(t))}),c(14),o(),n(15,"td")(16,"button",23),u("click",function(){let t=_(r).$implicit,i=d();return g(i.calificarMedico(t))}),c(17," Calificar "),o()(),n(18,"td")(19,"button",23),u("click",function(){let t=_(r).$implicit,i=d();return g(i.realizarEncuesta(t))}),c(20," Encuesta "),o()()()()}if(a&2){let r=l.$implicit,e=l.index;p(),m("ngClass",k(2,8,r.estado)),p(3),v(e+1),p(2),v(r.medico),p(2),v(r.especialidad),p(2),S(" ",T(12,12,k(11,10,r.hora),"shortTime")," "),p(4),v(r.estado),p(2),m("disabled",r.estado!=="realizado"),p(3),m("disabled",r.estado!=="realizado"&&r.comentario!==null)}}var Ie=(()=>{let l=class l{constructor(e,t,i,f,h){this.firestoreS=e,this.filtro=t,this.pacienteS=i,this.authS=f,this.especialistaS=h,this.p=1,this.ptwo=1,this.p3=1,this.arrProfesionales=[],this.arrTurnos=[],this.arrPacientes=[],this.usuarioElegidoEmail="",this.user=[],this.opciones=[],this.fechas=[],this.horarios=[],this.totalHorarios=[],this.subscription=[],this.searchEspecialista="",this.firestore=I(L),this.selectedRow=-1}ngOnDestroy(){this.subscription&&this.subscription.forEach(e=>e.unsubscribe())}ngOnInit(){this.subscription?.push(this.pacienteS.obtenerTurnosPorPaciente(this.authS.getUser()?.email).subscribe(e=>{this.arrTurnos=[],e.forEach(t=>{this.arrTurnos.push(t)})})),Y(G(this.firestore,"especialidades")).subscribe(e=>{this.opciones=[],e.forEach(t=>{this.opciones.push({etiqueta:t.especialidad,valor:t.especialidad,foto:t.foto?t.foto:"https://firebasestorage.googleapis.com/v0/b/clinica-b786b.appspot.com/o/imagenes%2Fsinfoto.png?alt=media&token=84d0fe71-d138-42c7-8a81-aa6fba263646"})})})}getEspecialidadesOpciones(e,t){this.subscription?.push(this.firestoreS.obtenerEspecialistaPorEspecialidad(e).subscribe(i=>{this.arrProfesionales=[],i.forEach(f=>{this.arrProfesionales.push(M({opcion:e},f))}),this.arrProfesionales.length===0&&s.default.fire("No hay profesionales disponibles","","info")})),this.fechas=[],this.horarios=[],this.totalHorarios=[]}elegirMedico(e){this.fechas=[],this.horarios=[],this.totalHorarios=[];let t=new Date;t.setHours(0,0,0,0);for(let i=0;i<e.fechas.length;i++)if(e.opcion===Object.keys(e.fechas[i])[0]){let f=Object.keys(e.fechas[i])[0],h=Object.values(e.fechas[i])[0],F=e.id,O=new Date(h.seconds*1e3),he=t.getDate().toString(),_e=(t.getMonth()+1).toString(),ge=t.getFullYear().toString();debugger;if(O>=t){let V=O.toLocaleDateString();this.horarios[V]||(this.horarios[V]=[]),this.horarios[V].push({especialidad:f,timestamp:h,medico:e.id})}}this.totalHorarios.push(e.fechas),this.fechas=Object.keys(this.horarios).map(i=>({fecha:i,horarios:this.horarios[i]})),this.fechas.length===0&&s.default.fire("No hay turnos disponibles","","info")}elegirUsuario(e){s.default.fire(`Usuario elegido:${e.email}`,"","success"),this.usuarioElegidoEmail=e.email}elegirHorario(e){this.horarios=[],this.horarios.push(e.horarios)}solicitarTurno(e){console.log(this.horarios),s.default.fire({title:"\xBFDesea solicitar turno?",showDenyButton:!0,confirmButtonText:"Si",denyButtonText:"No"}).then(t=>{t.isConfirmed?this.especialistaS.obtenerMedicoPorId(e.medico).then(i=>{let f="",h="",F="";i.exists()&&(f=i.data().email,h=i.data().nombre,F=i.data().apellido),this.pacienteS.ingresarTurnoPaciente(this.usuarioElegidoEmail?this.usuarioElegidoEmail:this.authS.getUser()?.email,e.especialidad,e.medico,f,e.timestamp,h,F).then(()=>{let O=this.fechas.splice(this.fechas.indexOf(e),1);this.usuarioElegidoEmail="",this.especialistaS.actualizarHorario(e.medico,e,this.totalHorarios)}).then(()=>{s.default.fire("Turno solicitado","","success"),this.fechas=[],this.horarios=[],this.totalHorarios=[]})}):t.isDenied&&s.default.fire("Turno no solicitado","","info")})}calificarMedico(e){if(e.calificacion){s.default.fire("Calificacion ya realizada","","info");return}s.default.fire({title:"Califique al medico",input:"radio",inputOptions:{1:"1",2:"2",3:"3",4:"4",5:"5"},showDenyButton:!0,confirmButtonText:"Calificar",denyButtonText:"No calificar"}).then(t=>{t.isConfirmed?this.pacienteS.ingresarCalificacionMedico(e.id,t.value).then(()=>{s.default.fire(`Calificacion:${t.value}`,"","success")}):t.isDenied&&s.default.fire("Calificacion no realizada","","info")})}realizarEncuesta(e){return j(this,null,function*(){if(e.encuesta){s.default.fire("Encuesta ya realizada","","info");return}let{value:t}=yield s.default.fire({title:"Realice encuesta",input:"text",inputPlaceholder:"Ingrese encuesta",showCancelButton:!0,inputValidator:i=>!i&&"Complete el campo con texto valido"});t?this.pacienteS.ingresarEncuesta(e.id,t).then(()=>{s.default.fire("Encuesta realizada","","success")}):s.default.fire("Encuesta no realizada","","info")})}manejoTurno(e){if(e.estado==="cancelado"){s.default.fire("Turno ya cancelado","","info");return}if(e.estado==="realizado")if(e.reseniaOk===!0){s.default.fire(`Rese\xF1a:${e.comentario}`,"","info");return}else s.default.fire({title:"\xBFDesea agregar rese\xF1a?",showDenyButton:!0,confirmButtonText:"Si",denyButtonText:"No"}).then(t=>{t.isConfirmed?s.default.fire({title:"Ingrese rese\xF1a",input:"text",inputPlaceholder:"Ingrese rese\xF1a",showCancelButton:!0}).then(i=>{i.isConfirmed&&this.pacienteS.ingresarResenia(e.id,i.value).then(()=>{s.default.fire("Rese\xF1a agregada","","success")})}):t.isDenied&&s.default.fire("Rese\xF1a no agregada","","info")});e.estado==="abierto"&&s.default.fire({title:"\xBFDesea cancelar turno? , ingrese motivo:",showDenyButton:!0,confirmButtonText:"Si",denyButtonText:"No",input:"text"}).then(t=>{t.isConfirmed?this.pacienteS.cancelarTurno(e.id,t.value).then(()=>{s.default.fire("Turno cancelado","","success")}):t.isDenied&&s.default.fire("Turno no cancelado","","info")})}filtrarEspecialista(){this.arrProfesionales=this.filtro.transform(this.arrProfesionales,this.searchEspecialista)}};l.\u0275fac=function(t){return new(t||l)(b(J),b(w),b(Z),b(W),b(ee))},l.\u0275cmp=$({type:l,selectors:[["app-paciente-turnos"]],standalone:!0,features:[H([w]),N],decls:60,vars:18,consts:[[1,"full-background"],[1,"d-flex","flex-row","justify-content-start","align-items-start","mt-3","ms-3"],[1,"d-flex","flex-row","justify-content-center","allign-item-center"],[2,"overflow-y","scroll","height","800px"],[1,"table","especialidades"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],[1,"d-flex","flex-column","justify-content-center","allign-item-center","ms-3"],[1,"table"],[1,"table",2,"width","350px"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"card","p-4","shadow","ms-3","mt-3",2,"padding","20px"],[1,"d-flex","flex-column","justify-content-center","align-items-center"],[4,"ngFor","ngForOf"],["id","turnos",1,"my-pagination",3,"pageChange"],[3,"click"],[3,"ngClass"],[1,"btn","btn-primary",2,"width","350px","border-radius","20px"],["alt","","srcset","",2,"width","50px","height","50px",3,"src"],["alt","...",2,"height","50px","width","50px",3,"src"],[3,"click","ngClass"],[1,"btn","btn-primary",2,"width","350px"],["scope","row"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(t,i){t&1&&(n(0,"div",0),P(1,"app-navbar"),n(2,"div",1)(3,"div",2)(4,"div",3)(5,"table",4)(6,"thead")(7,"tr")(8,"th",5),c(9,"Especialidad"),o()()(),C(10,pe,5,4,"tbody",6),o()()(),n(11,"div",7)(12,"table",8)(13,"thead")(14,"tr")(15,"th",5),c(16,"Foto"),o()()(),C(17,de,7,2,"tbody",6),x(18,"filtro"),x(19,"paginate"),o(),n(20,"div",2)(21,"table",9)(22,"thead")(23,"tr")(24,"th",5),c(25,"Dia"),o()()(),n(26,"tbody"),C(27,me,4,4,"tr",10),o()()(),n(28,"table",9)(29,"thead")(30,"tr")(31,"th",5),c(32,"Horario"),o()()(),n(33,"tbody"),C(34,ue,6,9,"tr",10),o()()(),n(35,"div")(36,"div",11)(37,"h4"),c(38,"Turnos"),o(),n(39,"div",12)(40,"table",8)(41,"thead")(42,"tr")(43,"th",5),c(44,"#"),o(),n(45,"th",5),c(46,"Medico"),o(),n(47,"th",5),c(48,"Especialidad"),o(),n(49,"th",5),c(50,"Hora"),o(),n(51,"th",5),c(52,"Estado"),o(),n(53,"th",5),c(54,"Calificar Medico"),o(),n(55,"th",5),c(56,"Encuesta"),o()()(),C(57,fe,21,15,"tbody",13),x(58,"paginate"),o(),n(59,"pagination-controls",14),u("pageChange",function(h){return i.ptwo=h}),o()()()()()()),t&2&&(p(10),m("ngForOf",i.opciones),p(7),m("ngForOf",T(19,8,T(18,5,i.arrProfesionales,i.searchEspecialista),E(14,ce,i.p))),p(10),m("ngForOf",i.fechas),p(7),m("ngForOf",i.horarios[0]),p(23),m("ngForOf",T(58,11,i.arrTurnos,E(16,le,i.ptwo))))},dependencies:[A,R,U,q,X,Q,ne,te,ie,K,w,re,oe],styles:[".full-background[_ngcontent-%COMP%]{width:100vw;height:100vh}[_nghost-%COMP%]{display:block;background-image:url(/assets/pattern.jpg)}.my-pagination[_ngcontent-%COMP%]     .ngx-pagination .current{color:#000}.panelusuarios[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #e9ecef;border-radius:5px;margin-top:10px;padding:50px;background-color:#faebd7;cursor:pointer}.panelturnos[_ngcontent-%COMP%]{border-radius:5px;margin-top:10px;padding:50px;background-color:#faebd7;cursor:pointer}.especialidades[_ngcontent-%COMP%]{width:350px;cursor:pointer}"]});let a=l;return a})();export{Ie as PacienteTurnosComponent};
