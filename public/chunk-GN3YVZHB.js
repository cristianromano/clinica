import{A as n,B as d,C as S,H as U,J as g,O as j,u as p,x as c,z as b}from"./chunk-PLM2N6DR.js";import{Y as f,ba as m,ca as l,f as o,m as h}from"./chunk-CPSHSAPU.js";var x=(()=>{let s=class s{constructor(e){this.firestoreS=e,this.auth=l(p),this.firestore=l(S),this.userSubject=new h(null),this.user$=this.userSubject.asObservable(),this.userSubject=new h(null),this.user$=this.userSubject.asObservable(),this.auth.onAuthStateChanged(t=>{t?this.firestoreS.obtenerFirestoreUsuarioAdmin(t.email).then(i=>{let r={uid:t.uid,email:t.email,nombre:t.displayName,tipo:"",imagenes:[],autorizado:!1,apellido:"",edad:0,dni:"",obrasocial:""};this.userSubject.next(r)}):this.userSubject.next(null)})}getCurrentUserValue(){return this.userSubject.value}logueado(){return this.auth.currentUser}crearUsuario(e,t,i,r){return o(this,null,function*(){return yield c(this.auth,e,t).then(a=>{b(a.user),d(a.user,{photoURL:i,displayName:r})})})}crearUsuarioAdmin(e,t,i,r){return o(this,null,function*(){return yield c(this.auth,e,t).then(a=>o(this,null,function*(){d(a.user,{photoURL:i,displayName:r})}))})}getUser(){return this.auth.currentUser}esAdmin(){return new Promise((e,t)=>{g(U(this.firestore,"users")).then(i=>{i.forEach(r=>{r.data().email==this.auth.currentUser?.email&&r.data().admin=="true"&&e(!0)})}).catch(i=>{console.error("Error fetching user data:",i),t(!1)})})}logueo(e,t){return o(this,null,function*(){let i=[];if(i=yield this.firestoreS.obtenerFirestoreUsuario(e),i[0].tipo=="profesional"&&i.length>0){let r=yield n(this.auth,e,t),a=this.verificarEmailValidadoProfesional(r);return{autorizado:i[0].autorizado,tipo:i[0].tipo,validado:a}}else if(i[0].tipo=="paciente"&&i.length>0){let r=yield n(this.auth,e,t);return this.verificarEmailValidado(r)}else{yield n(this.auth,e,t);let r;return yield this.firestoreS.obtenerFirestoreUsuarioAdmin(e).then(a=>{a.forEach(v=>{r=v.tipo})}),{tipo:r}}})}verificarEmailValidadoProfesional(e){return e.user.emailVerified}verificarEmailValidado(e){return{validado:e.user.emailVerified,tipo:"paciente"}}signOut(){return this.auth.signOut().then(()=>{this.userSubject.next(null)})}};s.\u0275fac=function(t){return new(t||s)(m(j))},s.\u0275prov=f({token:s,factory:s.\u0275fac,providedIn:"root"});let u=s;return u})();export{x as a};
