import{a as ne}from"./chunk-RLNOM6ZC.js";import{a as P,b as ie}from"./chunk-6ZRPZ7NW.js";import{a as Y}from"./chunk-L7GHGVGE.js";import{a as X}from"./chunk-E4UZH4GH.js";import{a as Z,b as ee,c as te}from"./chunk-V4624JQ6.js";import{a as oe}from"./chunk-7VGHOT3T.js";import{p as J,q as K}from"./chunk-IDY3ZXSF.js";import{a as W}from"./chunk-WJSC7PN5.js";import{a as Q}from"./chunk-RBADOQRF.js";import{C as q,E as A,H as L,P as G}from"./chunk-IXUCQNA3.js";import{c as H,d as N,h as R,j as U}from"./chunk-YW5BT2SR.js";import{$ as I,Cb as $,Da as O,Db as z,Fb as T,Ha as p,Hb as x,Ia as C,Ib as F,Jb as v,Wa as y,Ya as m,cb as n,da as M,db as o,eb as k,ib as E,lb as f,mb as d,na as h,oa as _,pb as D,vb as c,wb as S,xb as w}from"./chunk-LTJRTMYM.js";import{a as B,e as re,g as j}from"./chunk-5G567QLT.js";var s=re(oe());var ae=a=>({itemsPerPage:5,currentPage:a,id:"profesionales"}),se=a=>({itemsPerPage:5,currentPage:a,id:"turnos"}),V=a=>({"table-primary":a});function ce(a,l){if(a&1){let r=E();n(0,"tbody",15),f("click",function(){let e=h(r),i=e.$implicit,u=e.index,g=d();return _(g.getEspecialidadesOpciones(i.valor,u))}),n(1,"tr",16)(2,"td",2)(3,"button",17),k(4,"img",18),o()()()()}if(a&2){let r=l.$implicit,t=l.index,e=d();p(),m("ngClass",T(2,V,e.selectedRow===t)),p(3),m("src",r.foto,O)}}function le(a,l){if(a&1){let r=E();n(0,"tbody",15),f("click",function(){let e=h(r).$implicit,i=d();return _(i.elegirMedico(e))}),n(1,"tr")(2,"td")(3,"button",17),k(4,"img",19)(5,"br"),c(6),o()()()()}if(a&2){let r=l.$implicit;p(4),D("src",r.imagenes,O),p(2),w(" ",r.nombre," ")}}function pe(a,l){if(a&1){let r=E();n(0,"tr",20),f("click",function(){let e=h(r).$implicit,i=d();return _(i.elegirHorario(e))}),n(1,"td")(2,"button",21),c(3),o()()()}if(a&2){let r=l.$implicit,t=l.index,e=d();m("ngClass",T(2,V,e.selectedRow===t)),p(3),w(" ",r.fecha," ")}}function de(a,l){if(a&1){let r=E();n(0,"tr",20),f("click",function(){let e=h(r).$implicit,i=d();return _(i.solicitarTurno(e))}),n(1,"td")(2,"button",21),c(3),x(4,"convertirfecha"),x(5,"date"),o()()()}if(a&2){let r=l.$implicit,t=l.index,e=d();m("ngClass",T(7,V,e.selectedRow===t)),p(3),w(" ",v(5,4,F(4,2,r.timestamp),"shortTime")," ")}}function me(a,l){if(a&1){let r=E();n(0,"tbody")(1,"tr",16),x(2,"coloresturnos"),n(3,"th",22),c(4),o(),n(5,"td",15),f("click",function(){let e=h(r).$implicit,i=d();return _(i.manejoTurno(e))}),c(6),o(),n(7,"td",15),f("click",function(){let e=h(r).$implicit,i=d();return _(i.manejoTurno(e))}),c(8),o(),n(9,"td",15),f("click",function(){let e=h(r).$implicit,i=d();return _(i.manejoTurno(e))}),c(10),x(11,"convertirfecha"),x(12,"date"),o(),n(13,"td",15),f("click",function(){let e=h(r).$implicit,i=d();return _(i.manejoTurno(e))}),c(14),o(),n(15,"td")(16,"button",23),f("click",function(){let e=h(r).$implicit,i=d();return _(i.calificarMedico(e))}),c(17," Calificar "),o()(),n(18,"td")(19,"button",23),f("click",function(){let e=h(r).$implicit,i=d();return _(i.realizarEncuesta(e))}),c(20," Encuesta "),o()()()()}if(a&2){let r=l.$implicit,t=l.index;p(),m("ngClass",F(2,8,r.estado)),p(3),S(t+1),p(2),S(r.medico),p(2),S(r.especialidad),p(2),w(" ",v(12,12,F(11,10,r.hora),"shortTime")," "),p(4),S(r.estado),p(2),m("disabled",r.estado!=="realizado"),p(3),m("disabled",r.estado!=="realizado"&&r.comentario!==null)}}var Be=(()=>{let l=class l{constructor(t,e,i,u,g){this.firestoreS=t,this.filtro=e,this.pacienteS=i,this.authS=u,this.especialistaS=g,this.p=1,this.ptwo=1,this.p3=1,this.arrProfesionales=[],this.arrTurnos=[],this.arrPacientes=[],this.usuarioElegidoEmail="",this.user=[],this.opciones=[],this.fechas=[],this.horarios=[],this.totalHorarios=[],this.subscription=[],this.searchEspecialista="",this.firestore=I(q),this.selectedRow=-1}ngOnDestroy(){this.subscription&&this.subscription.forEach(t=>t.unsubscribe())}ngOnInit(){this.subscription?.push(this.pacienteS.obtenerTurnosPorPaciente(this.authS.getUser()?.email).subscribe(t=>{this.arrTurnos=[],t.forEach(e=>{this.arrTurnos.push(e)})})),A(L(this.firestore,"especialidades")).subscribe(t=>{this.opciones=[],t.forEach(e=>{this.opciones.push({etiqueta:e.especialidad,valor:e.especialidad,foto:e.foto?e.foto:"https://firebasestorage.googleapis.com/v0/b/clinica-b786b.appspot.com/o/imagenes%2Fsinfoto.png?alt=media&token=84d0fe71-d138-42c7-8a81-aa6fba263646"})})})}getEspecialidadesOpciones(t,e){this.subscription?.push(this.firestoreS.obtenerEspecialistaPorEspecialidad(t).subscribe(i=>{this.arrProfesionales=[],i.forEach(u=>{this.arrProfesionales.push(B({opcion:t},u))}),this.arrProfesionales.length===0&&s.default.fire("No hay profesionales disponibles","","info")})),this.fechas=[],this.horarios=[],this.totalHorarios=[]}elegirMedico(t){this.fechas=[],this.horarios=[],this.totalHorarios=[];debugger;for(let e=0;e<t.fechas.length;e++)if(t.opcion===Object.keys(t.fechas[e])[0]){let i=Object.keys(t.fechas[e])[0],u=Object.values(t.fechas[e])[0],g=t.id,b=new Date(u.seconds*1e3).toLocaleDateString();this.horarios[b]||(this.horarios[b]=[]),this.horarios[b].push({especialidad:i,timestamp:u,medico:t.id})}this.totalHorarios.push(t.fechas),this.fechas=Object.keys(this.horarios).map(e=>({fecha:e,horarios:this.horarios[e]})),this.fechas.length===0&&s.default.fire("No hay turnos disponibles","","info")}elegirUsuario(t){s.default.fire(`Usuario elegido:${t.email}`,"","success"),this.usuarioElegidoEmail=t.email}elegirHorario(t){this.horarios=[],this.horarios.push(t.horarios)}solicitarTurno(t){console.log(this.horarios),s.default.fire({title:"\xBFDesea solicitar turno?",showDenyButton:!0,confirmButtonText:"Si",denyButtonText:"No"}).then(e=>{e.isConfirmed?this.especialistaS.obtenerMedicoPorId(t.medico).then(i=>{let u="",g="",b="";i.exists()&&(u=i.data().email,g=i.data().nombre,b=i.data().apellido),this.pacienteS.ingresarTurnoPaciente(this.usuarioElegidoEmail?this.usuarioElegidoEmail:this.authS.getUser()?.email,t.especialidad,t.medico,u,t.timestamp,g,b).then(()=>{let ue=this.fechas.splice(this.fechas.indexOf(t),1);this.usuarioElegidoEmail="",this.especialistaS.actualizarHorario(t.medico,t,this.totalHorarios)}).then(()=>{s.default.fire("Turno solicitado","","success"),this.fechas=[],this.horarios=[],this.totalHorarios=[]})}):e.isDenied&&s.default.fire("Turno no solicitado","","info")})}calificarMedico(t){if(t.calificacion){s.default.fire("Calificacion ya realizada","","info");return}s.default.fire({title:"Califique al medico",input:"radio",inputOptions:{1:"1",2:"2",3:"3",4:"4",5:"5"},showDenyButton:!0,confirmButtonText:"Calificar",denyButtonText:"No calificar"}).then(e=>{e.isConfirmed?this.pacienteS.ingresarCalificacionMedico(t.id,e.value).then(()=>{s.default.fire(`Calificacion:${e.value}`,"","success")}):e.isDenied&&s.default.fire("Calificacion no realizada","","info")})}realizarEncuesta(t){return j(this,null,function*(){if(t.encuesta){s.default.fire("Encuesta ya realizada","","info");return}let{value:e}=yield s.default.fire({title:"Realice encuesta",input:"text",inputPlaceholder:"Ingrese encuesta",showCancelButton:!0,inputValidator:i=>!i&&"Complete el campo con texto valido"});e?this.pacienteS.ingresarEncuesta(t.id,e).then(()=>{s.default.fire("Encuesta realizada","","success")}):s.default.fire("Encuesta no realizada","","info")})}manejoTurno(t){if(t.estado==="cancelado"){s.default.fire("Turno ya cancelado","","info");return}if(t.estado==="realizado")if(t.reseniaOk===!0){s.default.fire(`Rese\xF1a:${t.comentario}`,"","info");return}else s.default.fire({title:"\xBFDesea agregar rese\xF1a?",showDenyButton:!0,confirmButtonText:"Si",denyButtonText:"No"}).then(e=>{e.isConfirmed?s.default.fire({title:"Ingrese rese\xF1a",input:"text",inputPlaceholder:"Ingrese rese\xF1a",showCancelButton:!0}).then(i=>{i.isConfirmed&&this.pacienteS.ingresarResenia(t.id,i.value).then(()=>{s.default.fire("Rese\xF1a agregada","","success")})}):e.isDenied&&s.default.fire("Rese\xF1a no agregada","","info")});t.estado==="abierto"&&s.default.fire({title:"\xBFDesea cancelar turno? , ingrese motivo:",showDenyButton:!0,confirmButtonText:"Si",denyButtonText:"No",input:"text"}).then(e=>{e.isConfirmed?this.pacienteS.cancelarTurno(t.id,e.value).then(()=>{s.default.fire("Turno cancelado","","success")}):e.isDenied&&s.default.fire("Turno no cancelado","","info")})}filtrarEspecialista(){this.arrProfesionales=this.filtro.transform(this.arrProfesionales,this.searchEspecialista)}};l.\u0275fac=function(e){return new(e||l)(C(G),C(P),C(X),C(Q),C(Y))},l.\u0275cmp=M({type:l,selectors:[["app-paciente-turnos"]],standalone:!0,features:[$([P]),z],decls:60,vars:18,consts:[[1,"full-background"],[1,"d-flex","flex-row","justify-content-start","align-items-start","mt-3","ms-3"],[1,"d-flex","flex-row","justify-content-center","allign-item-center"],[2,"overflow-y","scroll","height","800px"],[1,"table","especialidades"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],[1,"d-flex","flex-column","justify-content-center","allign-item-center","ms-3"],[1,"table"],[1,"table",2,"width","350px"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"card","p-4","shadow","ms-3","mt-3",2,"padding","20px"],[1,"d-flex","flex-column","justify-content-center","align-items-center"],[4,"ngFor","ngForOf"],["id","turnos",1,"my-pagination",3,"pageChange"],[3,"click"],[3,"ngClass"],[1,"btn","btn-primary",2,"width","350px","border-radius","20px"],["alt","","srcset","",2,"width","50px","height","50px",3,"src"],["alt","...",2,"height","50px","width","50px",3,"src"],[3,"click","ngClass"],[1,"btn","btn-primary",2,"width","350px"],["scope","row"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(e,i){e&1&&(n(0,"div",0),k(1,"app-navbar"),n(2,"div",1)(3,"div",2)(4,"div",3)(5,"table",4)(6,"thead")(7,"tr")(8,"th",5),c(9,"Especialidad"),o()()(),y(10,ce,5,4,"tbody",6),o()()(),n(11,"div",7)(12,"table",8)(13,"thead")(14,"tr")(15,"th",5),c(16,"Foto"),o()()(),y(17,le,7,2,"tbody",6),x(18,"filtro"),x(19,"paginate"),o(),n(20,"div",2)(21,"table",9)(22,"thead")(23,"tr")(24,"th",5),c(25,"Dia"),o()()(),n(26,"tbody"),y(27,pe,4,4,"tr",10),o()()(),n(28,"table",9)(29,"thead")(30,"tr")(31,"th",5),c(32,"Horario"),o()()(),n(33,"tbody"),y(34,de,6,9,"tr",10),o()()(),n(35,"div")(36,"div",11)(37,"h4"),c(38,"Turnos"),o(),n(39,"div",12)(40,"table",8)(41,"thead")(42,"tr")(43,"th",5),c(44,"#"),o(),n(45,"th",5),c(46,"Medico"),o(),n(47,"th",5),c(48,"Especialidad"),o(),n(49,"th",5),c(50,"Hora"),o(),n(51,"th",5),c(52,"Estado"),o(),n(53,"th",5),c(54,"Calificar Medico"),o(),n(55,"th",5),c(56,"Encuesta"),o()()(),y(57,me,21,15,"tbody",13),x(58,"paginate"),o(),n(59,"pagination-controls",14),f("pageChange",function(g){return i.ptwo=g}),o()()()()()()),e&2&&(p(10),m("ngForOf",i.opciones),p(7),m("ngForOf",v(19,8,v(18,5,i.arrProfesionales,i.searchEspecialista),T(14,ae,i.p))),p(10),m("ngForOf",i.fechas),p(7),m("ngForOf",i.horarios[0]),p(23),m("ngForOf",v(58,11,i.arrTurnos,T(16,se,i.ptwo))))},dependencies:[U,H,N,R,W,K,te,Z,ee,J,P,ie,ne],styles:[".full-background[_ngcontent-%COMP%]{width:100vw;height:100vh}[_nghost-%COMP%]{display:block;background-image:url(/assets/pattern.jpg)}.my-pagination[_ngcontent-%COMP%]     .ngx-pagination .current{color:#000}.panelusuarios[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #e9ecef;border-radius:5px;margin-top:10px;padding:50px;background-color:#faebd7;cursor:pointer}.panelturnos[_ngcontent-%COMP%]{border-radius:5px;margin-top:10px;padding:50px;background-color:#faebd7;cursor:pointer}.especialidades[_ngcontent-%COMP%]{width:350px;cursor:pointer}"]});let a=l;return a})();export{Be as PacienteTurnosComponent};
